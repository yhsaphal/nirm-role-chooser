<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex" />
  <title>NIRM Hero Box</title>
  <style>
    /* Your CSS unchanged */
  </style>
  <script src="https://cdn.auth0.com/js/auth0-spa-js/1.13/auth0-spa-js.production.js"></script>
</head>
<body>
  <div class="hero-box">
    <div class="logo">NIRM</div>
    <div class="tagline">
      <span>
        Connecting You to the Best<br />
        Your Vision, Our Tech<br />
        Your Event, Your Way<br />
        Built for You<br />
        Powered by SapphireAI, Backed by OpenAI<br />
        The Clear Path for Seamless Execution<br />
        Your Sourcing Solution<br />
        Where Events Meet Innovation
      </span>
    </div>
    <div class="buttons">
      <button onclick="handleRoleSelect('individual')">An Individual User</button>
      <button onclick="handleRoleSelect('business')">A Business Owner</button>
    </div>
  </div>

  <script>
    // Wrap everything inside an async IIFE so we can use await at the top level
    (async () => {
      const auth0 = await createAuth0Client({
        domain: "nirm.uk.auth0.com",
        client_id: "nPJ9Ks5rLkanZ4D6C3Qud5gu5vIkopm6",
      });

      window.handleRoleSelect = async function(role) {
        try {
          const user = await auth0.getUser();
          if (!user) {
            alert("You must be logged in to select a role.");
            return;
          }
          const userId = user.sub;

          // Send userId and role to your Make webhook
          await fetch("https://hook.eu2.make.com/87ho7oa10qtc65gt7k1yhlodo07nuq9y", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ user_id: userId, role: role })
          });

          // Redirect after successful webhook call
          if (role === "individual") {
            window.location.href = "https://nirm.uk/formindividual";
          } else {
            window.location.href = "https://nirm.uk/formbusiness";
          }
        } catch (err) {
          console.error("Error assigning role:", err);
          alert("Something went wrong. Please refresh and try again.");
        }
      }
    })();
  </script>
</body>
</html>
