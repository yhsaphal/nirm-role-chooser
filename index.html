<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Choose Your Role | NIRM</title>
  <meta name="robots" content="noindex, nofollow" />
  <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque&display=swap" rel="stylesheet" />
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Bricolage Grotesque', sans-serif;
      background: #fffcf0;
      color: #001b3e;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      display: flex;
      height: 100vh;
      width: 100%;
      overflow: hidden;
    }

    /* Left side with animated text */
    .left-side {
      flex: 1;
      position: relative;
      background: linear-gradient(135deg, #001b3e 0%, #003366 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      color: white;
      text-align: center;
      padding: 0 20px;
    }

    .left-side::after {
      content: "";
      position: absolute;
      inset: 0;
      background-color: rgba(0, 27, 62, 0.6);
      pointer-events: none;
      z-index: 1;
    }

    .text-container {
      position: relative;
      z-index: 2;
      max-width: 400px;
    }

    .nirm-title {
      font-size: 5rem;
      font-weight: 900;
      margin: 0 0 1rem 0;
      text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.7);
      user-select: none;
    }

    .animated-sentences {
      font-size: 1.75rem;
      font-weight: 500;
      min-height: 3.5rem;
      text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.6);
      user-select: none;
      line-height: 1.3;
    }

    /* Right side */
    .right-side {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 60px 40px;
      background-color: #fffcf0;
      text-align: center;
      box-sizing: border-box;
      position: relative;
      z-index: 10;
      color: #001b3e;
    }

    .right-side h1 {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 40px;
      letter-spacing: 0.04em;
      user-select: none;
    }

    .role-button {
      background-color: #001b3e;
      color: white;
      border: none;
      padding: 18px 44px;
      margin: 12px 0;
      font-size: 20px;
      font-weight: 600;
      border-radius: 9999px;
      cursor: pointer;
      box-shadow: 0 6px 0 #00122e;
      transition: transform 0.18s ease, box-shadow 0.18s ease, background-color 0.3s ease;
      width: 280px;
      user-select: none;
      will-change: transform;
    }
    .role-button:hover {
      background-color: #1f2f57;
      transform: translateY(-3px);
      box-shadow: 0 9px 8px rgba(0,0,0,0.15);
    }
    .role-button:active {
      transform: translateY(4px);
      box-shadow: 0 2px 0 #00122e;
      background-color: #00122e;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .left-side, .right-side {
        flex: none;
        width: 100%;
        height: 50vh;
      }
      .role-button {
        width: 80%;
        max-width: 300px;
      }
      .nirm-title {
        font-size: 3.5rem;
      }
      .animated-sentences {
        font-size: 1.25rem;
      }
      .right-side h1 {
        font-size: 28px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="left-side">
      <div class="text-container">
        <h1 class="nirm-title">NIRM</h1>
        <p class="animated-sentences"></p>
      </div>
    </div>
    <div class="right-side">
      <h1>Who are you?</h1>
      <button class="role-button" onclick="setRole('individual')">I'm an Individual</button>
      <button class="role-button" onclick="setRole('business')">I'm a Business Owner</button>
    </div>
  </div>

  <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
  <script>
    // Sentences you chose for the animated text
    const sentences = [
      "Connecting You to the Best.",
      "Your Vision, Our Tech.",
      "Your Event, Your Way.",
      "Built for You.",
      "Powered by SapphireAI, Backed by OpenAI.",
      "The Clear Path for Seamless Execution.",
      "Your sourcing solution."
    ];

    const sentenceElement = document.querySelector(".animated-sentences");
    let index = 0;
    let charIndex = 0;
    let isDeleting = false;
    const typingSpeed = 80;
    const pauseBetween = 2200;

    function typeSentence() {
      const current = sentences[index];
      if (!isDeleting) {
        sentenceElement.textContent = current.substring(0, charIndex + 1);
        charIndex++;
        if (charIndex === current.length) {
          isDeleting = true;
          setTimeout(typeSentence, pauseBetween);
          return;
        }
      } else {
        sentenceElement.textContent = current.substring(0, charIndex - 1);
        charIndex--;
        if (charIndex === 0) {
          isDeleting = false;
          index = (index + 1) % sentences.length;
        }
      }
      setTimeout(typeSentence, isDeleting ? typingSpeed / 2 : typingSpeed);
    }

    typeSentence();

    // Auth0 client init + role setting
    setTimeout(() => {
      (async () => {
        const auth0 = await createAuth0Client({
          domain: "nirm.uk.auth0.com",
          client_id: "nPJ9Ks5rLkanZ4D6C3Qud5gu5vIkopm6",
          cacheLocation: "localstorage"
        });

        // Optionally you can add login checks here if needed

        window.setRole = async (role) => {
          try {
            const user = await auth0.getUser();
            const token = await auth0.getTokenSilently({
              audience: "https://nirm.uk.auth0.com/api/v2/"
            });

            await fetch(`https://nirm.uk.auth0.com/api/v2/users/${user.sub}`, {
              method: "PATCH",
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                user_metadata: { role }
              })
            });

            const redirectURL = role === "individual"
              ? "https://nirm.uk/form/individual"
              : "https://nirm.uk/form/business";

            window.location.href = redirectURL;

          } catch (err) {
            alert("Something went wrong while setting your role. Please try again.");
            console.error(err);
          }
        };
      })();
    }, 200);
  </script>
</body>
</html>
